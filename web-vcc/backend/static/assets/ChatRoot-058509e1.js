/**
 * The frontend part of web-vcc
 * @copyright The vcc group
 * @license AGPL-3.0-or-later
 */
import{l as Ce,w as je,m as Se,y as k,_ as pe,n as Y,q as _,s as D,t as fe,v as J,x as Pe,I as ze,j as q,a as K,d as z,c as X,z as re,T as F,r as V,A as le,o as n,k as H,B as W,C as Ae,p as ae,D as ee,S as Ee,g as Z,f as Q,V as G,h as M,L as Ve,F as se,E as Fe,G as qe,O as He}from"./index-057a36d6.js";function Ie(e,a){if(e==null)return{};var t={},s=Object.keys(e),i,r;for(r=0;r<s.length;r++)i=s[r],!(a.indexOf(i)>=0)&&(t[i]=e[i]);return t}function ie(e,a){if(e==null)return{};var t=Ie(e,a),s,i;if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(i=0;i<r.length;i++)s=r[i],!(a.indexOf(s)>=0)&&Object.prototype.propertyIsEnumerable.call(e,s)&&(t[s]=e[s])}return t}var Me={area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0};const Ue=Ce(Me);var Be=/\s([^'"/\s><]+?)[\s/>]|([^\s=]+)=\s?(".*?"|'.*?')/g;function de(e){var a={type:"tag",name:"",voidElement:!1,attrs:{},children:[]},t=e.match(/<\/?([^\s]+?)[/\s>]/);if(t&&(a.name=t[1],(Ue[t[1]]||e.charAt(e.length-2)==="/")&&(a.voidElement=!0),a.name.startsWith("!--"))){var s=e.indexOf("-->");return{type:"comment",comment:s!==-1?e.slice(4,s):""}}for(var i=new RegExp(Be),r=null;(r=i.exec(e))!==null;)if(r[0].trim())if(r[1]){var o=r[1].trim(),u=[o,""];o.indexOf("=")>-1&&(u=o.split("=")),a.attrs[u[0]]=u[1],i.lastIndex--}else r[2]&&(a.attrs[r[2]]=r[3].trim().substring(1,r[3].length-1));return a}var Ke=/<[a-zA-Z0-9\-\!\/](?:"[^"]*"|'[^']*'|[^'">])*>/g,Te=/^\s*$/,$e=Object.create(null);function ve(e,a){switch(a.type){case"text":return e+a.content;case"tag":return e+="<"+a.name+(a.attrs?function(t){var s=[];for(var i in t)s.push(i+'="'+t[i]+'"');return s.length?" "+s.join(" "):""}(a.attrs):"")+(a.voidElement?"/>":">"),a.voidElement?e:e+a.children.reduce(ve,"")+"</"+a.name+">";case"comment":return e+"<!--"+a.comment+"-->"}}var De={parse:function(e,a){a||(a={}),a.components||(a.components=$e);var t,s=[],i=[],r=-1,o=!1;if(e.indexOf("<")!==0){var u=e.indexOf("<");s.push({type:"text",content:u===-1?e:e.substring(0,u)})}return e.replace(Ke,function(f,h){if(o){if(f!=="</"+t.name+">")return;o=!1}var p,l=f.charAt(1)!=="/",x=f.startsWith("<!--"),d=h+f.length,c=e.charAt(d);if(x){var N=de(f);return r<0?(s.push(N),s):((p=i[r]).children.push(N),s)}if(l&&(r++,(t=de(f)).type==="tag"&&a.components[t.name]&&(t.type="component",o=!0),t.voidElement||o||!c||c==="<"||t.children.push({type:"text",content:e.slice(d,e.indexOf("<",d))}),r===0&&s.push(t),(p=i[r-1])&&p.children.push(t),i[r]=t),(!l||t.voidElement)&&(r>-1&&(t.voidElement||t.name===f.slice(2,-1))&&(r--,t=r===-1?s:i[r]),!o&&c!=="<"&&c)){p=r===-1?s:i[r].children;var v=e.indexOf("<",d),b=e.slice(d,v===-1?void 0:v);Te.test(b)&&(b=" "),(v>-1&&r+p.length>=0||b!==" ")&&p.push({type:"text",content:b})}}),s},stringify:function(e){return e.reduce(function(a,t){return a+ve("",t)},"")}},Le=["format"],Qe=["children","count","parent","i18nKey","context","tOptions","values","defaults","components","ns","i18n","t","shouldUnescape"];function he(e,a){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);a&&(s=s.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,s)}return t}function j(e){for(var a=1;a<arguments.length;a++){var t=arguments[a]!=null?arguments[a]:{};a%2?he(Object(t),!0).forEach(function(s){pe(e,s,t[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):he(Object(t)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(t,s))})}return e}function ne(e,a){if(!e)return!1;var t=e.props?e.props.children:e.children;return a?t.length>0:!!t}function te(e){return e?e.props?e.props.children:e.children:[]}function Je(e){return Object.prototype.toString.call(e)!=="[object Array]"?!1:e.every(function(a){return Y(a)})}function L(e){return Array.isArray(e)?e:[e]}function We(e,a){var t=j({},a);return t.props=Object.assign(e.props,a.props),t}function be(e,a){if(!e)return"";var t="",s=L(e),i=a.transSupportBasicHtmlNodes&&a.transKeepBasicHtmlNodesFor?a.transKeepBasicHtmlNodesFor:[];return s.forEach(function(r,o){if(typeof r=="string")t+="".concat(r);else if(Y(r)){var u=Object.keys(r.props).length,f=i.indexOf(r.type)>-1,h=r.props.children;if(!h&&f&&u===0)t+="<".concat(r.type,"/>");else if(!h&&(!f||u!==0))t+="<".concat(o,"></").concat(o,">");else if(r.props.i18nIsDynamicList)t+="<".concat(o,"></").concat(o,">");else if(f&&u===1&&typeof h=="string")t+="<".concat(r.type,">").concat(h,"</").concat(r.type,">");else{var p=be(h,a);t+="<".concat(o,">").concat(p,"</").concat(o,">")}}else if(r===null)_("Trans: the passed in value is invalid - seems you passed in a null child.");else if(D(r)==="object"){var l=r.format,x=ie(r,Le),d=Object.keys(x);if(d.length===1){var c=l?"".concat(d[0],", ").concat(l):d[0];t+="{{".concat(c,"}}")}else _("react-i18next: the passed in object contained more than one variable - the object should look like {{ value, format }} where format is optional.",r)}else _("Trans: the passed in value is invalid - seems you passed in a variable like {number} - please pass in variables for interpolation as full objects like {{number}}.",r)}),t}function Ye(e,a,t,s,i,r){if(a==="")return[];var o=s.transKeepBasicHtmlNodesFor||[],u=a&&new RegExp(o.join("|")).test(a);if(!e&&!u)return[a];var f={};function h(v){var b=L(v);b.forEach(function(y){typeof y!="string"&&(ne(y)?h(te(y)):D(y)==="object"&&!Y(y)&&Object.assign(f,y))})}h(e);var p=De.parse("<0>".concat(a,"</0>")),l=j(j({},f),i);function x(v,b,y){var g=te(v),P=c(g,b.children,y);return Je(g)&&P.length===0?g:P}function d(v,b,y,g,P){v.dummy&&(v.children=b),y.push(J(v,j(j({},v.props),{},{key:g}),P?void 0:b))}function c(v,b,y){var g=L(v),P=L(b);return P.reduce(function(C,m,A){var I=m.children&&m.children[0]&&m.children[0].content&&t.services.interpolator.interpolate(m.children[0].content,l,t.language);if(m.type==="tag"){var E=g[parseInt(m.name,10)];!E&&y.length===1&&y[0][m.name]&&(E=y[0][m.name]),E||(E={});var O=Object.keys(m.attrs).length!==0?We({props:m.attrs},E):E,w=Y(O),S=w&&ne(m,!0)&&!m.voidElement,T=u&&D(O)==="object"&&O.dummy&&!w,U=D(e)==="object"&&e!==null&&Object.hasOwnProperty.call(e,m.name);if(typeof O=="string"){var B=t.services.interpolator.interpolate(O,l,t.language);C.push(B)}else if(ne(O)||S){var $=x(O,m,y);d(O,$,C,A)}else if(T){var R=c(g,m.children,y);C.push(J(O,j(j({},O.props),{},{key:A}),R))}else if(Number.isNaN(parseFloat(m.name)))if(U){var Ne=x(O,m,y);d(O,Ne,C,A,m.voidElement)}else if(s.transSupportBasicHtmlNodes&&o.indexOf(m.name)>-1)if(m.voidElement)C.push(k(m.name,{key:"".concat(m.name,"-").concat(A)}));else{var Oe=c(g,m.children,y);C.push(k(m.name,{key:"".concat(m.name,"-").concat(A)},Oe))}else if(m.voidElement)C.push("<".concat(m.name," />"));else{var ke=c(g,m.children,y);C.push("<".concat(m.name,">").concat(ke,"</").concat(m.name,">"))}else if(D(O)==="object"&&!w){var oe=m.children[0]?I:null;oe&&C.push(oe)}else m.children.length===1&&I?C.push(J(O,j(j({},O.props),{},{key:A}),I)):C.push(J(O,j(j({},O.props),{},{key:A})))}else if(m.type==="text"){var ce=s.transWrapTextNodes,ue=r?s.unescape(t.services.interpolator.interpolate(m.content,l,t.language)):t.services.interpolator.interpolate(m.content,l,t.language);ce?C.push(k(ce,{key:"".concat(m.name,"-").concat(A)},ue)):C.push(ue)}return C},[])}var N=c([{dummy:!0,children:e||[]}],p,L(e||[]));return te(N[0])}function Ge(e){var a=e.children,t=e.count,s=e.parent,i=e.i18nKey,r=e.context,o=e.tOptions,u=o===void 0?{}:o,f=e.values,h=e.defaults,p=e.components,l=e.ns,x=e.i18n,d=e.t,c=e.shouldUnescape,N=ie(e,Qe),v=x||fe();if(!v)return je("You will need to pass in an i18next instance by using i18nextReactModule"),a;var b=d||v.t.bind(v)||function(S){return S};r&&(u.context=r);var y=j(j({},Se()),v.options&&v.options.react),g=l||b.ns||v.options&&v.options.defaultNS;g=typeof g=="string"?[g]:g||["translation"];var P=h||be(a,y)||y.transEmptyNodeValue||i,C=y.hashTransKey,m=i||(C?C(P):P),A=f?u.interpolation:{interpolation:j(j({},u.interpolation),{},{prefix:"#$?",suffix:"?$#"})},I=j(j(j(j({},u),{},{count:t},f),A),{},{defaultValue:P,ns:g}),E=m?b(m,I):P,O=Ye(p||a,E,v,y,I,c),w=s!==void 0?s:y.defaultTransParent;return w?k(w,N,O):O}var Xe=["children","count","parent","i18nKey","context","tOptions","values","defaults","components","ns","i18n","t","shouldUnescape"];function me(e,a){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);a&&(s=s.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,s)}return t}function Ze(e){for(var a=1;a<arguments.length;a++){var t=arguments[a]!=null?arguments[a]:{};a%2?me(Object(t),!0).forEach(function(s){pe(e,s,t[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):me(Object(t)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(t,s))})}return e}function Re(e){var a=e.children,t=e.count,s=e.parent,i=e.i18nKey,r=e.context,o=e.tOptions,u=o===void 0?{}:o,f=e.values,h=e.defaults,p=e.components,l=e.ns,x=e.i18n,d=e.t,c=e.shouldUnescape,N=ie(e,Xe),v=Pe(ze)||{},b=v.i18n,y=v.defaultNS,g=x||b||fe(),P=d||g&&g.t.bind(g);return Ge(Ze({children:a,count:t,parent:s,i18nKey:i,context:r,tOptions:u,values:f,defaults:h,components:p,ns:l||P&&P.ns||y||g&&g.options&&g.options.defaultNS,i18n:g,t:d,shouldUnescape:c},N))}const _e=e=>k("svg",{xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",...e},k("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 4c1.93 0 3.5 1.57 3.5 3.5S13.93 13 12 13s-3.5-1.57-3.5-3.5S10.07 6 12 6zm0 14c-2.03 0-4.43-.82-6.14-2.88a9.947 9.947 0 0 1 12.28 0C16.43 19.18 14.03 20 12 20z"})),ge=e=>k("svg",{xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",...e},k("path",{d:"M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"})),ye=e=>k("svg",{xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",...e},k("path",{d:"M3 17v2h6v-2H3zM3 5v2h10V5H3zm10 16v-2h8v-2h-8v-2h-2v6h2zM7 9v2H3v2h4v2h2V9H7zm14 4v-2H11v2h10zm-6-4h2V7h4V5h-4V3h-2v6z"})),we=e=>k("svg",{xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",...e},k("path",{d:"M16.59 8.59 12 13.17 7.41 8.59 6 10l6 6 6-6-1.41-1.41z"})),xe=e=>k("svg",{xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",...e},k("path",{d:"m12 8-6 6 1.41 1.41L12 10.83l4.59 4.58L18 14l-6-6z"})),en=e=>k("svg",{xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",...e},k("path",{d:"M6 10c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm12 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm-6 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"})),nn=e=>k("svg",{xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",...e},k("path",{d:"M9 13.75c-2.34 0-7 1.17-7 3.5V19h14v-1.75c0-2.33-4.66-3.5-7-3.5zM4.34 17c.84-.58 2.87-1.25 4.66-1.25s3.82.67 4.66 1.25H4.34zM9 12c1.93 0 3.5-1.57 3.5-3.5S10.93 5 9 5 5.5 6.57 5.5 8.5 7.07 12 9 12zm0-5c.83 0 1.5.67 1.5 1.5S9.83 10 9 10s-1.5-.67-1.5-1.5S8.17 7 9 7zm7.04 6.81c1.16.84 1.96 1.96 1.96 3.44V19h4v-1.75c0-2.02-3.5-3.17-5.96-3.44zM15 12c1.93 0 3.5-1.57 3.5-3.5S16.93 5 15 5c-.54 0-1.04.13-1.5.35.63.89 1 1.98 1 3.15s-.37 2.26-1 3.15c.46.22.96.35 1.5.35z"}));function tn({id:e}){var h;const[a,t]=q(""),{t:s}=K(),i=Z(),{successAlert:r,errorAlert:o}=X(),{refresh:u}=Q(),f=F(async()=>{let p;try{p=parseInt(a)}catch(l){return}p!==null&&(await V.chat.join(p)?(await u(),i(`/chats/${p}`),r(s("You have joined the chat successfully. "))):o(s("No such chat. ")))},[r,o,u,a]);return le(n(H,{children:[n("input",{type:"checkbox",id:e,className:"modal-toggle"}),n("div",{className:"modal",children:n("div",{className:"modal-box",children:[n("h3",{className:"font-bold text-lg",children:s("Join chat")}),n("p",{className:"py-4",children:s("Enter the chat number you want to join.")}),n("input",{className:"input",autoFocus:!0,placeholder:(h=s("Chat id"))!=null?h:"",value:a,onInput:p=>t(p.currentTarget.value)}),n("div",{className:"modal-action",children:[n("label",{htmlFor:e,className:"btn",children:s("Close")}),n("button",{className:"btn",onClick:f,children:s("Join")})]})]})})]}),document.body)}function an({id:e,uid:a}){var p;const[t,s]=q(""),{t:i}=K(),r=z(l=>l.chat),{successAlert:o,errorAlert:u}=X(),f=re(),h=F(async()=>{t!==null&&(await V.chat.changeNickname(r,a,t)?(f.invalidateQueries(["get-nickname",a]),o(i("You have changed the nickname successfully. "))):u(i("Permission denied. ")))},[o,u,t]);return le(n(H,{children:[n("input",{type:"checkbox",id:e,className:"modal-toggle"}),n("div",{className:"modal",children:n("div",{className:"modal-box",children:[n("h3",{className:"font-bold text-lg",children:i("Change nickname")}),n("p",{className:"py-4",children:i("Enter the new nickname you want to change.")}),n("input",{className:"input",autoFocus:!0,placeholder:(p=i("New nickname"))!=null?p:"",value:t,onInput:l=>s(l.currentTarget.value)}),n("div",{className:"modal-action",children:[n("label",{htmlFor:e,className:"btn",children:i("Close")}),n("button",{className:"btn",onClick:h,children:i("Change")})]})]})})]}),document.body)}function sn({uid:e,username:a,modifyPermissionDialogID:t}){const{successAlert:s,errorAlert:i}=X(),r=z(d=>d.chat),{data:o}=W({queryKey:["user-permission",r],queryFn:async()=>{if(r!=null)return await V.chat.getAllPermission(r)},enabled:r!=null}),u=o==null?void 0:o[e],f=re(),[h,p]=Ae((d,{key:c,value:N})=>({...d,[c]:N}),{kick:!1,rename:!1,invite:!1,modify_permission:!1,send:!0,create_sub_chat:!1,create_session:!0,banned:!1,change_nickname:!1}),{t:l}=K();function x(d){const c=h[d];return u!=null&&u[d]==c?Promise.resolve(!0):V.chat.modifyUserPermission(r,e,d,c)}return ae(()=>{u&&p(u)},[u]),n(H,{children:le(n(H,{children:[n("input",{type:"checkbox",id:t,className:"modal-toggle"}),n("div",{className:"modal",children:n("div",{className:"modal-box",children:[n("h3",{className:"font-bold text-lg",children:l("Modify permission")}),n("p",{className:"py-4",children:n(Re,{i18nKey:"modify-permission-dialog-description",children:["Modify permission of ",{username:a},"."]})}),n("div",{className:"flex flex-col",children:ee.map(d=>n(Ee,{checked:h[d],setChecked:c=>p({key:d,value:c}),label:l(d)},d))}),n("div",{className:"modal-action",children:[n("label",{htmlFor:t,className:"btn",children:l("Close")}),n("button",{className:"btn",onClick:async()=>{const d=await Promise.all(ee.map(x));f.invalidateQueries({queryKey:["user-permission",r]}),d.reduce((N,v)=>N&&v)?s(l("Permission has successfully been modified.")):i(l("Permission denied."))},disabled:u==null||ee.map(d=>u[d]==h[d]).reduce((d,c)=>d&&c),children:l("Apply")})]})]})})]}),document.body)})}const rn=e=>k("svg",{xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",...e},k("path",{d:"M22 9V7h-2v2h-2v2h2v2h2v-2h2V9zM8 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0-6c1.1 0 2 .9 2 2s-.9 2-2 2-2-.9-2-2 .9-2 2-2zm0 7c-2.67 0-8 1.34-8 4v3h16v-3c0-2.66-5.33-4-8-4zm6 5H2v-.99C2.2 16.29 5.3 15 8 15s5.8 1.29 6 2v1zM12.51 4.05C13.43 5.11 14 6.49 14 8s-.57 2.89-1.49 3.95C14.47 11.7 16 10.04 16 8s-1.53-3.7-3.49-3.95zm4.02 9.78C17.42 14.66 18 15.7 18 17v3h2v-3c0-1.45-1.59-2.51-3.47-3.17z"})),ln=e=>k("svg",{xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",...e},k("path",{d:"M13 7h-2v4H7v2h4v4h2v-4h4v-2h-4V7zm-1-5C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z"}));function on(){const e=Z(),{t:a}=K(),t=G(),s=F(()=>{e("/chats/create")},[]);return n(H,{children:[n(tn,{id:t}),n("div",{className:"flex",children:[n("div",{className:"opacity-80 text-sm m-4 select-none",children:a("Chat")}),n("div",{className:"dropdown ml-auto dropdown-end",children:[n("label",{tabIndex:0,className:"btn btn-square btn-ghost",children:n(ge,{})}),n("ul",{tabIndex:0,className:"dropdown-content menu whitespace-nowrap bg-base-100 p-2 rounded-box mr-2",children:[n("li",{children:n("a",{onClick:s,children:[n("div",{className:"my-auto opacity-60",children:n(ln,{})}),n("div",{className:"text-base ml-2",children:a("Create Chat")})]})}),n("li",{children:n("label",{htmlFor:t,children:[n("div",{className:"my-auto opacity-60",children:n(rn,{})}),n("div",{className:"text-base ml-2",children:a("Join Chat")})]})})]})]})]})]})}function cn({toggle:e,toggleRightSidebar:a}){const t=z(r=>r.chatName),s=z(r=>r.session),{t:i}=K();return n("div",{className:"navbar bg-base-100",children:[n("div",{className:"flex-none sm:hidden",children:n("button",{className:"btn btn-square btn-ghost",onClick:e,children:n(ge,{})})}),n("div",{className:"flex-auto overflow-hidden",children:n("a",{className:"btn btn-ghost normal-case text-xl text-ellipsis",children:s!=null?s:t})}),n("div",{className:"flex-none",children:n("div",{className:"dropdown dropdown-end",children:[n("label",{tabIndex:0,className:"btn btn-square btn-ghost",children:n(_e,{})}),n("ul",{tabIndex:0,className:"dropdown-content menu p-2 shadow bg-base-100 rounded-box w-52",children:n("li",{children:n(Ve,{to:"/logout",children:i("Logout")})})})]})}),s==null&&n("div",{className:"flex-none",children:n("button",{className:"btn btn-square btn-ghost inline-flex",onClick:a,children:n(nn,{})})})]})}function un({chat:e,clickHandler:a,settingsClickHandler:t,setOpen:s}){const i=z(l=>l.chat),{values:r,names:o}=Q(),u=z(l=>l.sessions).filter(([l])=>l==e).map(([,l])=>l),f=z(l=>l.session),[h,p]=q(!0);return n(H,{children:[n("li",{className:"py-1 px-2 flex w-full btn-group",children:[n("button",{className:M("flex flex-1 btn font-normal normal-case",i==e&&f==null?"btn-primary":"btn-ghost"),onClick:()=>{s(!1),a(e,o[r.indexOf(e)],null)},children:n("div",{className:"ml-2 text-base my-auto mr-auto",children:o[r.indexOf(e)]})}),!!u.length&&n("button",{className:"btn btn-accent",onClick:()=>{p(!h)},children:h?n(we,{}):n(xe,{})}),n("button",{className:"btn btn-secondary",onClick:t(e,o[r.indexOf(e)]),children:n(ye,{})})]}),!!u.length&&!h&&u.map(l=>n("li",{className:"py-1 px-2 flex w-full btn-group",children:n("button",{className:M("flex flex-1 btn font-normal normal-case",i==e&&l==f?"btn-accent":"btn-ghost"),onClick:()=>{s(!1),a(e,o[r.indexOf(e)],l)},children:n("div",{className:"ml-4 text-base my-auto mr-auto",children:l})})},l))]})}function dn({value:e,setOpen:a,subChats:t}){const s=Z(),i=z(c=>c.chat),{values:r,names:o}=Q(),u=z(c=>c.changeChat),f=z(c=>c.changeChatName),h=z(c=>c.changeSession),[p,l]=q(!0),x=F((c,N,v=null)=>{u(c),f(N),h(v),s(`/chats/${c}`)},[]),d=F((c,N)=>function(){u(c),f(N),s(`/chats/${c}/settings/info`),a(!1)},[]);return n(H,{children:[n("li",{className:"py-1 px-2 flex w-full btn-group",children:[n("button",{className:M("flex flex-1 btn font-normal normal-case",i==e?"btn-primary":"btn-ghost"),onClick:()=>{a(!1),x(e,o[r.indexOf(e)])},children:n("div",{className:"text-base my-auto mr-auto",children:o[r.indexOf(e)]})}),n("button",{className:M("btn btn-accent",{hidden:!t.length}),onClick:()=>{l(!p)},children:p?n(we,{}):n(xe,{})}),n("button",{className:"btn btn-secondary",onClick:d(e,o[r.indexOf(e)]),children:n(ye,{})})]}),!p&&t.map(c=>n(un,{chat:c,setOpen:a,clickHandler:x,settingsClickHandler:d},c))]})}function hn({open:e,setOpen:a}){const{parentChats:t}=Q(),s=se(()=>Object.entries(t).map(i=>n(dn,{value:Number(i[0]),setOpen:a,subChats:i[1]},i[0])),[t,a]);return n(H,{children:n("div",{"aria-hidden":!e,className:M("duration-300 overflow-x-hidden w-full transition-all no-scrollbar sm:max-w-[16rem] sm:w-[16rem]",{"max-w-full w-full overflow-y-auto":e,"max-w-0 overflow-y-hidden":!e}),children:[n(on,{}),n("ul",{className:"flex flex-col",children:s})]})})}function mn({name:e,id:a,online:t,setHandleUsername:s,setHandleUserID:i,first:r,menu:o}){var c,N,v,b;const u=e.split(" "),f=((N=(c=u[0])==null?void 0:c[0])!=null?N:"").toUpperCase(),h=((b=(v=u[1])==null?void 0:v[0])!=null?b:"").toUpperCase(),{t:p}=K(),[l,x]=q(!1),d=F(()=>{x(!l),s(e),i(a)},[l,e,a]);return n(H,{children:[!r&&n("div",{className:"divider my-0"}),n("li",{className:"flex items-start py-2 px-6 my-1",children:[n("div",{className:M("avatar placeholder text-lg mr-4",t?"online":"offline"),children:n("div",{className:"rounded-full w-10 h-10",style:{backgroundColor:qe(e)},children:n("span",{className:"text-white",children:[f,h]})})}),n("div",{className:"flex flex-col flex-1",children:[n("div",{className:"break-normal [overflow-wrap:anywhere]",children:e}),n("span",{className:"opacity-50 text-sm mt-1",children:p(t?"Online":"Offline")})]}),n("div",{className:"dropdown dropdown-end",children:[n("label",{tabIndex:0,onClick:d,className:"btn btn-ghost btn-square my-auto",children:n(en,{})}),o]})]})]})}function pn({open:e,setOpen:a}){var O;const t=z(w=>w.chat),{successAlert:s,errorAlert:i}=X(),{refresh:r,values:o,isLoading:u}=Q(),f=Z(),{t:h}=K();ae(()=>{!u&&t!=null&&!o.includes(t)&&f("/chats/empty")},[t,o]);const p=re(),{data:l}=W({queryKey:["user-list",t],queryFn:async()=>t==null?[]:await V.chat.getUsers(t),enabled:t!=null});ae(()=>{if(l)for(const[w,S]of l)p.setQueryData(["get-nickname",t,w],S)},[l]);const{data:x}=W({queryKey:["user-permission",t],queryFn:async()=>{if(t!=null)return await V.chat.getAllPermission(t)},enabled:t!=null}),{data:d}=W({queryKey:["is-online",l],queryFn:async()=>t==null||l==null||!l.length?[]:await V.user.isOnline(l.map(w=>w[0])),enabled:t!=null&&l!=null&&!!(l!=null&&l.length)}),c=se(()=>{var w,S,T,U;return l?d===void 0?(S=(w=l==null?void 0:l.map)==null?void 0:w.call(l,([B,$])=>[$,B,!1]))!=null?S:[]:(U=(T=l==null?void 0:l.map)==null?void 0:T.call(l,([B,$],R)=>[$,B,d[R]]))!=null?U:[]:[]},[l,d]),[N,v]=q(""),[b,y]=q(0),g=z(w=>w.username),P=F(async()=>{t!=null&&(N==g?await V.chat.quit(t)?(s(h("You have quit the chat successfully. ")),r()):i(h("Unexpected error: You haven't quit the chat successfully. ")):await V.chat.kick(t,b)?(s(h("User has been kicked.")),r(),p.invalidateQueries({queryKey:["user-list",t]})):i(h("Permission denied.")))},[t,b]),C=F(async()=>{var S;const w=!((S=x==null?void 0:x[b])!=null&&S.banned);await V.chat.modifyUserPermission(t,b,"banned",w)?(s(h(w?"User has been successfully banned.":"User has been successfully unbanned.")),r(),p.invalidateQueries({queryKey:["user-list",t]})):i(h("Permission denied."))},[b]),m=G(),A=G(),I=n("ul",{className:"menu mt-4 bg-base-100 flex-1 ml-auto dropdown-content whitespace-nowrap",tabIndex:0,children:[n("li",{children:n("a",{onClick:P,children:h(N==g?"Quit":"Kick")})}),n("li",{children:n("a",{onClick:C,children:h((O=x==null?void 0:x[b])!=null&&O.banned?"Unban":"Ban")})}),n("li",{children:n("label",{htmlFor:m,children:h("Modify Permission")})}),n("li",{children:n("label",{htmlFor:A,children:h("Change Nickname")})})]}),E=se(()=>c.sort().sort((w,S)=>-w[2]||+S[2]).sort((w,S)=>-(w[0]==g)||+(S[0]==g)),[c,g]);return n("div",{className:M("w-full overflow-x-hidden flex transition-all duration-300 no-scrollbar bg-base-100",{"sm:max-w-[18rem] max-w-full sm:w-[18rem] w-full overflow-y-auto":e,"max-w-0 overflow-y-hidden":!e}),children:[n(sn,{uid:b,username:N,modifyPermissionDialogID:m}),n(an,{id:A,uid:b}),n("ul",{className:"flex-1 flex flex-col py-2 max-w-full",children:[n("button",{className:"btn btn-ghost btn-circle sm:hidden",onClick:()=>a(!1),children:n(Fe,{})}),E.map((w,S)=>{const[T,U,B]=w;return n(mn,{name:T,id:U,online:B,setHandleUsername:v,setHandleUserID:y,first:!S,menu:I},U)})]})]})}function fn({children:e}){const[a,t]=q(!1),[s,i]=q(!1),r=z(h=>h.session),o=F(()=>t(!a),[t,a]),u=F(()=>i(!s),[i,s]),f=G();return n("div",{className:"flex flex-1 overflow-hidden drawer drawer-mobile",children:[n("input",{id:f,type:"checkbox",className:"drawer-toggle"}),n(hn,{open:a,setOpen:t}),n("div",{className:M("flex flex-col flex-1 transition-all duration-300 overflow-x-hidden",s||a?"w-0 sm:w-auto":"w-full"),children:[n(cn,{toggle:o,toggleRightSidebar:u}),e]}),r==null&&n(pn,{open:s,setOpen:i})]})}function bn(){return n(fn,{children:n(He,{})})}export{bn as Component};
